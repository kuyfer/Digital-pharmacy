<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Détails Alerte - Digital Pharmacy</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet">
</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container">
        <a class="navbar-brand" href="/">
            <i class="fas fa-clinic-medical me-2"></i>Digital Pharmacy
        </a>
    </div>
</nav>

<div class="container mt-4">
    <div class="row">
        <div class="col-12">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/">Accueil</a></li>
                    <li class="breadcrumb-item"><a href="/dashboard">Alertes</a></li>
                    <li class="breadcrumb-item active">Détails Alerte</li>
                </ol>
            </nav>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-8">
            <div class="card fade-in">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h4 class="mb-0">
                        <i class="fas fa-info-circle me-2"></i>
                        Détails de l'Alerte
                    </h4>
                    <div>
                            <span th:if="${product.estPerime()}" class="badge bg-danger me-2">
                                <i class="fas fa-skull-crossbones me-1"></i>PRODUIT PÉRIMÉ
                            </span>
                        <span th:if="${product.estBientotPerime()}" class="badge bg-warning me-2">
                                <i class="fas fa-clock me-1"></i>BIENTÔT PÉRIMÉ
                            </span>
                        <span th:if="${product.estStockFaible()}" class="badge bg-info">
                                <i class="fas fa-boxes me-1"></i>STOCK FAIBLE
                            </span>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h5 th:text="${product.nom}" class="text-primary"></h5>
                            <p class="text-muted" th:text="${product.description} ?: 'Aucune description'"></p>

                            <div class="mb-3">
                                <strong>Code CIP:</strong>
                                <span th:text="${product.codeCIP}" class="ms-2 font-monospace"></span>
                            </div>

                            <div class="mb-3">
                                <strong>Catégorie:</strong>
                                <span class="badge bg-secondary ms-2" th:text="${product.categorie}"></span>
                            </div>

                            <div class="mb-3">
                                <strong>Laboratoire:</strong>
                                <span th:text="${product.laboratoire} ?: 'Non spécifié'" class="ms-2"></span>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="alert alert-warning">
                                <h6><i class="fas fa-exclamation-triangle me-2"></i>Informations Critiques</h6>
                                <div th:if="${product.estPerime()}" class="text-danger">
                                    <i class="fas fa-calendar-times me-2"></i>
                                    <strong>Périmé depuis le</strong>
                                    <span th:text="${#temporals.format(product.dateExpiration, 'dd/MM/yyyy')}"></span>
                                </div>
                                <div th:if="${product.estBientotPerime()}" class="text-warning">
                                    <i class="fas fa-clock me-2"></i>
                                    <strong>Expire le</strong>
                                    <span th:text="${#temporals.format(product.dateExpiration, 'dd/MM/yyyy')}"></span>
                                </div>
                                <div th:if="${product.estStockFaible()}" class="text-info">
                                    <i class="fas fa-boxes me-2"></i>
                                    <strong>Stock faible:</strong>
                                    <span th:text="${product.quantiteStock} + ' unités'"></span>
                                    <small class="text-muted"> (seuil: 10 unités)</small>
                                </div>
                            </div>

                            <div class="mb-3">
                                <strong>Numéro de lot:</strong>
                                <span th:text="${product.numeroLot} ?: 'Non spécifié'" class="ms-2 font-monospace"></span>
                            </div>

                            <div class="mb-3">
                                <strong>Prescription requise:</strong>
                                <span th:if="${product.prescriptionRequise}" class="badge bg-danger ms-2">OUI</span>
                                <span th:unless="${product.prescriptionRequise}" class="badge bg-success ms-2">NON</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Actions Correctives -->
            <div class="card mt-4 fade-in">
                <div class="card-header">
                    <i class="fas fa-tools me-2"></i>Actions Correctives Recommandées
                </div>
                <div class="card-body">
                    <div th:if="${product.estPerime()}" class="alert alert-danger">
                        <h6><i class="fas fa-ban me-2"></i>Action Immédiate Requise</h6>
                        <ul>
                            <li>Retirer immédiatement le produit des rayons</li>
                            <li>Marquer comme "Périmé" dans le système</li>
                            <li>Contacter le fournisseur pour retour/remplacement</li>
                            <li>Documenter la procédure de retrait</li>
                        </ul>
                    </div>

                    <div th:if="${product.estBientotPerime()}" class="alert alert-warning">
                        <h6><i class="fas fa-clock me-2"></i>Actions à Planifier</h6>
                        <ul>
                            <li>Mettre en place une promotion pour écoulement rapide</li>
                            <li>Surveiller quotidiennement le stock</li>
                            <li>Prévoir le retrait 7 jours avant expiration</li>
                            <li>Commander du stock de remplacement</li>
                        </ul>
                    </div>

                    <div th:if="${product.estStockFaible()}" class="alert alert-info">
                        <h6><i class="fas fa-box me-2"></i>Gestion de Stock</h6>
                        <ul>
                            <li>Commander rapidement de nouvelles unités</li>
                            <li>Vérifier les délais de livraison</li>
                            <li>Anticiper la rupture de stock</li>
                            <li>Contacter le fournisseur pour approvisionnement urgent</li>
                        </ul>
                    </div>

                    <div class="text-center mt-3">
                        <button class="btn btn-success me-2" onclick="markAsResolved()">
                            <i class="fas fa-check me-2"></i>Marquer comme Résolu
                        </button>
                        <a th:href="@{/web/produits/{id}/edit(id=${product.id})}" class="btn btn-warning me-2">
                            <i class="fas fa-edit me-2"></i>Modifier le Produit
                        </a>
                        <a th:href="@{/web/produits}" class="btn btn-primary">
                            <i class="fas fa-list me-2"></i>Retour à la Liste
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
            <!-- Statut du Produit -->
            <div class="card fade-in">
                <div class="card-header">
                    <i class="fas fa-chart-bar me-2"></i>Statut du Produit
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <strong>Prix:</strong>
                        <span class="float-end fw-bold text-success"
                              th:text="${product.prix != null} ? '€ ' + #numbers.formatDecimal(product.prix, 1, 2, 2) : '€ 0.00'">
</span>
                    </div>
                    <div class="mb-3">
                        <strong>Stock actuel:</strong>
                        <span class="float-end fw-bold"
                              th:class="${product.estStockFaible()} ? 'text-warning' : 'text-success'"
                              th:text="${product.quantiteStock} + ' unités'"></span>
                    </div>
                    <div class="mb-3">
                        <strong>Date d'expiration:</strong>
                        <span th:if="${product.dateExpiration != null}"
                              class="float-end fw-bold"
                              th:class="${product.estPerime()} ? 'text-danger' : (${product.estBientotPerime()} ? 'text-warning' : 'text-success')"
                              th:text="${#temporals.format(product.dateExpiration, 'dd/MM/yyyy')}"></span>
                        <span th:if="${product.dateExpiration == null}" class="float-end text-muted">Non définie</span>
                    </div>
                    <hr>
                    <div class="text-center">
                        <small class="text-muted">Dernière mise à jour: Maintenant</small>
                    </div>
                </div>
            </div>

            <!-- Actions Rapides -->
            <div class="card mt-4 fade-in">
                <div class="card-header">
                    <i class="fas fa-bolt me-2"></i>Actions Rapides
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a th:href="@{/web/produits/{id}/augmenter-stock(id=${product.id})}"
                           class="btn btn-success btn-sm">
                            <i class="fas fa-plus me-2"></i>Augmenter le Stock
                        </a>
                        <a th:href="@{/web/produits/{id}/reduire-stock(id=${product.id})}"
                           class="btn btn-warning btn-sm">
                            <i class="fas fa-minus me-2"></i>Réduire le Stock
                        </a>
                        <button class="btn btn-info btn-sm" onclick="generateReport()">
                            <i class="fas fa-file-pdf me-2"></i>Générer Rapport
                        </button>
                        <button class="btn btn-secondary btn-sm" onclick="window.print()">
                            <i class="fas fa-print me-2"></i>Imprimer
                        </button>
                    </div>
                </div>
            </div>

            <!-- Historique des Alertes -->
            <div class="card mt-4 fade-in">
                <div class="card-header">
                    <i class="fas fa-history me-2"></i>Historique
                </div>
                <div class="card-body">
                    <div class="timeline">
                        <div class="timeline-item">
                            <div class="timeline-marker bg-danger"></div>
                            <div class="timeline-content">
                                <small class="text-muted">Aujourd'hui</small>
                                <p class="mb-1">Alerte créée - Produit périmé</p>
                            </div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-marker bg-warning"></div>
                            <div class="timeline-content">
                                <small class="text-muted">Il y a 15 jours</small>
                                <p class="mb-1">Alerte stock faible déclenchée</p>
                            </div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-marker bg-info"></div>
                            <div class="timeline-content">
                                <small class="text-muted">Il y a 1 mois</small>
                                <p class="mb-1">Produit ajouté au catalogue</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="/js/app.js"></script>
<script>
    function markAsResolved() {
        if (confirm('Êtes-vous sûr de vouloir marquer cette alerte comme résolue ?')) {
            showNotification('Alerte marquée comme résolue avec succès', 'success');
            setTimeout(() => {
                window.location.href = '/dashboard';
            }, 1500);
        }
    }

    function generateReport() {
        showNotification('Génération du rapport PDF...', 'info');
        // Simulation de génération de rapport
        setTimeout(() => {
            showNotification('Rapport généré avec succès!', 'success');
        }, 2000);
    }
</script>
</body>
</html>